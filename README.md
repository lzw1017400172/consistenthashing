# consistenthashing

一致性hash算法的简单java实现

# 倾斜test结果

===========================第一次查看倾斜结果：
node:192.168.1.1:125825(19.913%)

node:192.168.1.3:127162(20.125%)

node:192.168.1.2:141771(22.437%)

node:192.168.1.5:114987(18.198%)

node:192.168.1.4:122113(19.326%)

===========================添加节点192.168.1.6查看倾斜结果：
node:192.168.1.1:99757(15.788%)

node:192.168.1.3:104947(16.609%)

node:192.168.1.2:123947(19.616%)

node:192.168.1.5:95523(15.118%)

node:192.168.1.4:99900(15.811%)

node:192.168.1.6:107784(17.058%)

===========================添加节点192.168.1.7查看倾斜结果：
node:192.168.1.1:79461(12.576%)

node:192.168.1.3:86787(13.735%)

node:192.168.1.2:102458(16.215%)

node:192.168.1.5:86921(13.756%)

node:192.168.1.4:89595(14.18%)

node:192.168.1.7:101552(16.072%)

node:192.168.1.6:85084(13.466%)

===========================删除节点192.168.1.2查看倾斜结果：
node:192.168.1.1:94058(14.886%)

node:192.168.1.3:108077(17.105%)

node:192.168.1.5:100901(15.969%)

node:192.168.1.4:106375(16.835%)

node:192.168.1.7:123569(19.556%)

node:192.168.1.6:98878(15.649%)

===========================删除节点192.168.1.4查看倾斜结果：
node:192.168.1.1:117389(18.578%)

node:192.168.1.3:124164(19.651%)

node:192.168.1.5:119163(18.859%)

node:192.168.1.7:144595(22.884%)

node:192.168.1.6:126547(20.028%)

# 结论：

保证了尽可能的平衡性 :

- ​    初始化的节点，请求key散列较均匀；
- ​    新增了节点，请求key依然能保持散列较均匀；
- ​    删除了节点，请求key依然能保持散列较均匀；

# 路由变化test结果

===========================第一次查看路由变化对比结果：

node:192.168.1.1,原来的路由:0,当前节点的路由：125825,不变的路由：0,减少的路由:125825

node:192.168.1.3,原来的路由:0,当前节点的路由：127162,不变的路由：0,减少的路由:127162

node:192.168.1.2,原来的路由:0,当前节点的路由：141771,不变的路由：0,减少的路由:141771

node:192.168.1.5,原来的路由:0,当前节点的路由：114987,不变的路由：0,减少的路由:114987

node:192.168.1.4,原来的路由:0,当前节点的路由：122113,不变的路由：0,减少的路由:122113

===========================添加节点192.168.1.6查看路由变化对比结果：

node:192.168.1.1,原来的路由:125825,当前节点的路由：99757,不变的路由：99757,减少的路由:26068

node:192.168.1.3,原来的路由:127162,当前节点的路由：104947,不变的路由：104947,减少的路由:22215

node:192.168.1.2,原来的路由:141771,当前节点的路由：123947,不变的路由：123947,减少的路由:17824

node:192.168.1.5,原来的路由:114987,当前节点的路由：95523,不变的路由：95523,减少的路由:19464

node:192.168.1.4,原来的路由:122113,当前节点的路由：99900,不变的路由：99900,减少的路由:22213

node:192.168.1.6,原来的路由:0,当前节点的路由：107784,不变的路由：0,减少的路由:107784

===========================添加节点192.168.1.7查看路由变化对比结果：

node:192.168.1.1,原来的路由:99757,当前节点的路由：79461,不变的路由：79461,减少的路由:20296

node:192.168.1.3,原来的路由:104947,当前节点的路由：86787,不变的路由：86787,减少的路由:18160

node:192.168.1.2,原来的路由:123947,当前节点的路由：102458,不变的路由：102458,减少的路由:21489

node:192.168.1.5,原来的路由:95523,当前节点的路由：86921,不变的路由：86921,减少的路由:8602

node:192.168.1.4,原来的路由:99900,当前节点的路由：89595,不变的路由：89595,减少的路由:10305

node:192.168.1.7,原来的路由:0,当前节点的路由：101552,不变的路由：0,减少的路由:101552

node:192.168.1.6,原来的路由:107784,当前节点的路由：85084,不变的路由：85084,减少的路由:22700

===========================删除节点192.168.1.2查看路由变化对比结果：

node:192.168.1.1,原来的路由:79461,当前节点的路由：94058,不变的路由：79461,增加的路由:14597

node:192.168.1.3,原来的路由:86787,当前节点的路由：108077,不变的路由：86787,增加的路由:21290

node:192.168.1.5,原来的路由:86921,当前节点的路由：100901,不变的路由：86921,增加的路由:13980

node:192.168.1.4,原来的路由:89595,当前节点的路由：106375,不变的路由：89595,增加的路由:16780

node:192.168.1.7,原来的路由:101552,当前节点的路由：123569,不变的路由：101552,增加的路由:22017

node:192.168.1.6,原来的路由:85084,当前节点的路由：98878,不变的路由：85084,增加的路由:13794

===========================删除节点192.168.1.4查看路由变化对比结果：

node:192.168.1.1,原来的路由:94058,当前节点的路由：117389,不变的路由：94058,增加的路由:23331

node:192.168.1.3,原来的路由:108077,当前节点的路由：124164,不变的路由：108077,增加的路由:16087

node:192.168.1.5,原来的路由:100901,当前节点的路由：119163,不变的路由：100901,增加的路由:18262

node:192.168.1.7,原来的路由:123569,当前节点的路由：144595,不变的路由：123569,增加的路由:21026

node:192.168.1.6,原来的路由:98878,当前节点的路由：126547,不变的路由：98878,增加的路由:27669

# 结论

 保证了较高的单调性和较低分散性：

- ​    新增了节点，新增的节点分担了每个旧节点的部分请求key,保持大部分路由不改变；
- ​    删除了节点，剩余的节点平均分担了删除的节点的请求key，保持大部分路由不改变；
